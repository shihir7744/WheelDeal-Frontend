<div class="admin-dashboard">
  <div class="container-fluid py-4">
    <!-- Header -->
    <div class="dashboard-header text-center mb-4 fade-in">
      <h1 class="display-5 fw-bold text-white mb-3">
        <i class="fas fa-tachometer-alt me-3"></i>Admin Dashboard
      </h1>
      <p class="lead text-white-50">Comprehensive management system for WheelDeal Premium</p>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs-section mb-4">
      <div class="nav-tabs-container">
        <div class="scroll-indicator left" *ngIf="canScrollLeft" (click)="scrollLeft()">
          <i class="fas fa-chevron-left"></i>
        </div>
        <ul class="nav nav-tabs nav-fill admin-nav-tabs" #navTabs>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'overview'" (click)="switchTab('overview')">
              <i class="fas fa-chart-line me-2"></i>Overview
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'users'" (click)="switchTab('users')">
              <i class="fas fa-users me-2"></i>User Management
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'cars'" (click)="switchTab('cars')">
              <i class="fas fa-car me-2"></i>Car Management
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'bookings'" (click)="switchTab('bookings')">
              <i class="fas fa-calendar-check me-2"></i>Booking Management
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'financial'" (click)="switchTab('financial')">
              <i class="fas fa-dollar-sign me-2"></i>Financial Reports
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" [class.active]="activeTab === 'branches'" (click)="switchTab('branches')">
              <i class="fas fa-building me-2"></i>Branch Management
            </button>
          </li>
        </ul>
        <div class="scroll-indicator right" *ngIf="canScrollRight" (click)="scrollRight()">
          <i class="fas fa-chevron-right"></i>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-light" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="text-white mt-3">Loading dashboard data...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="alert alert-danger text-center" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ error }}
      <div class="mt-3">
        <button class="btn btn-outline-danger me-2" (click)="retryLoadData()">
          <i class="fas fa-redo me-2"></i>Retry All Data
        </button>
        <button class="btn btn-outline-warning" (click)="clearError()">
          <i class="fas fa-times me-2"></i>Dismiss
        </button>
      </div>
    </div>

    <!-- Overview Tab -->
    <div *ngIf="!isLoading && !error && activeTab === 'overview' && dashboardStats" class="dashboard-content">
      
      <!-- Key Metrics Row -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="stat-card card text-center bounce-in">
            <div class="card-body p-4">
              <div class="stat-icon mb-3">
                <i class="fas fa-car fa-2x text-primary"></i>
              </div>
              <h3 class="stat-number mb-2">{{ dashboardStats.totalCars }}</h3>
              <p class="stat-label mb-0">Total Cars</p>
              <small class="text-muted">{{ dashboardStats.availableCars }} available</small>
            </div>
          </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="stat-card card text-center bounce-in" style="animation-delay: 0.1s;">
            <div class="card-body p-4">
              <div class="stat-icon mb-3">
                <i class="fas fa-users fa-2x text-success"></i>
              </div>
              <h3 class="stat-number mb-2">{{ dashboardStats.totalUsers }}</h3>
              <p class="stat-label mb-0">Total Users</p>
              <small class="text-muted">{{ dashboardStats.newUsersThisMonth }} new this month</small>
            </div>
          </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="stat-card card text-center bounce-in" style="animation-delay: 0.2s;">
            <div class="card-body p-4">
              <div class="stat-icon mb-3">
                <i class="fas fa-calendar-check fa-2x text-info"></i>
              </div>
              <h3 class="stat-number mb-2">{{ dashboardStats.totalBookings }}</h3>
              <p class="stat-label mb-0">Total Bookings</p>
              <small class="text-muted">{{ dashboardStats.recentBookings }} recent</small>
            </div>
          </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="stat-card card text-center bounce-in" style="animation-delay: 0.3s;">
            <div class="card-body p-4">
              <div class="stat-icon mb-3">
                <i class="fas fa-dollar-sign fa-2x text-warning"></i>
              </div>
              <h3 class="stat-number mb-2">{{ formatCurrency(dashboardStats.totalRevenue) }}</h3>
              <p class="stat-label mb-0">Total Revenue</p>
              <small class="text-muted">{{ formatCurrency(dashboardStats.monthlyRevenue) }} this month</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Metrics -->
      <div class="row mb-4">
        <div class="col-lg-6 mb-3">
          <div class="card slide-up">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-line me-2"></i>Performance Metrics
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-6">
                  <div class="metric-item">
                    <span class="metric-label">Fleet Utilization</span>
                    <span class="metric-value" [class]="getUtilizationColor(dashboardStats.fleetUtilizationRate)">
                      {{ formatPercentage(dashboardStats.fleetUtilizationRate) }}
                    </span>
                  </div>
                </div>
                <div class="col-6">
                  <div class="metric-item">
                    <span class="metric-label">Avg Booking Value</span>
                    <span class="metric-value">{{ formatCurrency(dashboardStats.averageBookingValue) }}</span>
                  </div>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col-6">
                  <div class="metric-item">
                    <span class="metric-label">Active Bookings</span>
                    <span class="metric-value text-success">{{ dashboardStats.activeBookings }}</span>
                  </div>
                </div>
                <div class="col-6">
                  <div class="metric-item">
                    <span class="metric-label">Completed Bookings</span>
                    <span class="metric-value text-info">{{ dashboardStats.completedBookings }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-lg-6 mb-3">
          <div class="card slide-up">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-pie me-2"></i>Booking Status Distribution
              </h5>
            </div>
            <div class="card-body">
              <div class="booking-status-chart">
                <div class="status-item">
                  <span class="status-dot bg-success"></span>
                  <span class="status-label">Active: {{ dashboardStats.activeBookings }}</span>
                </div>
                <div class="status-item">
                  <span class="status-dot bg-info"></span>
                  <span class="status-label">Completed: {{ dashboardStats.completedBookings }}</span>
                </div>
                <div class="status-item">
                  <span class="status-dot bg-danger"></span>
                  <span class="status-label">Cancelled: {{ dashboardStats.cancelledBookings }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Management Tab -->
    <div *ngIf="activeTab === 'users'" class="dashboard-content">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center flex-wrap">
          <h5 class="mb-0">
            <i class="fas fa-users me-2"></i>User Management
          </h5>
          <button class="btn btn-primary" (click)="openUserModal()">
            <i class="fas fa-plus me-2"></i>Add User
          </button>
        </div>
        <div class="card-body">
          <!-- Loading State for Users -->
          <div *ngIf="users.length === 0 && !error" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-muted">Loading users...</p>
          </div>

          <!-- Users Table -->
          <div *ngIf="users.length > 0" class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of paginatedUsers">
                  <td>{{ user.id }}</td>
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="user-avatar me-2">
                        <i class="fas fa-user"></i>
                      </div>
                      <span>{{ user.fullName }}</span>
                    </div>
                  </td>
                  <td>{{ user.email }}</td>
                  <td>
                    <span class="badge" [class]="getRoleColor(user.role)">
                      {{ user.role }}
                    </span>
                  </td>
                  <td>
                    <span class="badge bg-success">Active</span>
                  </td>
                  <td>
                    <div class="btn-group" role="group">
                      <button class="btn btn-sm btn-outline-primary" (click)="openUserModal(user)" title="Edit User">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" (click)="deleteUser(user.id)" title="Delete User">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Empty State -->
          <div *ngIf="users.length === 0 && !error" class="text-center py-4">
            <i class="fas fa-users fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No Users Found</h5>
            <p class="text-muted">Start by adding your first user.</p>
            <button class="btn btn-primary" (click)="openUserModal()">
              <i class="fas fa-plus me-2"></i>Add First User
            </button>
          </div>
          
          <!-- Pagination -->
          <nav *ngIf="totalPages > 1">
            <ul class="pagination justify-content-center">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <button class="page-link" (click)="changePage(currentPage - 1)">Previous</button>
              </li>
              <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" 
                  [class.active]="currentPage === i + 1">
                <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
              </li>
              <li class="page-item" [class.disabled]="currentPage === totalPages">
                <button class="page-link" (click)="changePage(currentPage + 1)">Next</button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>

    <!-- Car Management Tab -->
    <div *ngIf="activeTab === 'cars'" class="dashboard-content">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center flex-wrap">
          <h5 class="mb-0">
            <i class="fas fa-car me-2"></i>Car Management
          </h5>
          <button class="btn btn-primary" (click)="openCarModal()">
            <i class="fas fa-plus me-2"></i>Add Car
          </button>
        </div>
        <div class="card-body">
          <!-- Loading State for Cars -->
          <div *ngIf="cars.length === 0 && !error" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-muted">Loading cars...</p>
          </div>

          <!-- Cars Table -->
          <div *ngIf="cars.length > 0" class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Car</th>
                  <th>Year</th>
                  <th>Price/Day</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let car of cars">
                  <td>{{ car.id }}</td>
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="car-icon me-2">
                        <i class="fas fa-car"></i>
                      </div>
                      <div>
                        <div class="fw-bold">{{ car.brand }} {{ car.model }}</div>
                        <small class="text-muted">{{ car.type }}</small>
                      </div>
                    </div>
                  </td>
                  <td>{{ car.year }}</td>
                  <td>{{ formatCurrency(car.price) }}</td>
                  <td>
                    <span class="badge" [class]="car.availability ? 'bg-success' : 'bg-danger'">
                      {{ car.availability ? 'Available' : 'Unavailable' }}
                    </span>
                  </td>
                  <td>
                    <div class="btn-group" role="group">
                      <button class="btn btn-sm btn-outline-primary" (click)="openCarModal(car)" title="Edit Car">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" (click)="deleteCar(car.id)" title="Delete Car">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Empty State -->
          <div *ngIf="cars.length === 0 && !error" class="text-center py-4">
            <i class="fas fa-car fa-3x text-muted mb-3"></i>
            <h5 class="text-muted">No Cars Found</h5>
            <p class="text-muted">Start by adding your first car to the fleet.</p>
            <button class="btn btn-primary" (click)="openCarModal()">
              <i class="fas fa-plus me-2"></i>Add First Car
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Booking Management Tab -->
    <div *ngIf="activeTab === 'bookings'" class="dashboard-content">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-calendar-check me-2"></i>Booking Management
          </h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>User</th>
                  <th>Car</th>
                  <th>Start Date</th>
                  <th>End Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let booking of bookings">
                  <td>{{ booking.id }}</td>
                  <td>{{ booking.userFullName }}</td>
                  <td>{{ booking.carBrand }} {{ booking.carModel }}</td>
                  <td>{{ formatDate(booking.startDate) }}</td>
                  <td>{{ formatDate(booking.endDate) }}</td>
                  <td>
                    <span class="badge" [class]="getStatusColor(booking.status)">
                      {{ booking.status }}
                    </span>
                  </td>
                  <td>
                    <button class="btn btn-sm btn-outline-info" (click)="openBookingModal(booking)">
                      <i class="fas fa-eye"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Financial Reports Tab -->
    <div *ngIf="activeTab === 'financial'" class="dashboard-content">
      <div class="row">
        <div class="col-lg-6 mb-3">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-chart-bar me-2"></i>Financial Summary
              </h5>
            </div>
            <div class="card-body" *ngIf="financialReport">
              <div class="financial-summary">
                <div class="summary-item">
                  <span class="summary-label">Total Revenue</span>
                  <span class="summary-value">{{ formatCurrency(financialReport.totalRevenue) }}</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Total Expenses</span>
                  <span class="summary-value">{{ formatCurrency(financialReport.totalExpenses) }}</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Net Profit</span>
                  <span class="summary-value text-success">{{ formatCurrency(financialReport.netProfit) }}</span>
                </div>
                <div class="summary-item">
                  <span class="summary-label">Profit Margin</span>
                  <span class="summary-value">{{ financialReport.profitMargin.toFixed(2) }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-lg-6 mb-3">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-exchange-alt me-2"></i>Recent Transactions
              </h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>Type</th>
                      <th>Amount</th>
                      <th>Status</th>
                      <th>Date</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let transaction of financialTransactions.slice(0, 5)">
                      <td>{{ transaction.transactionType }}</td>
                      <td>{{ formatCurrency(transaction.amount) }}</td>
                      <td>
                        <span class="badge" [class]="getStatusColor(transaction.status)">
                          {{ transaction.status }}
                        </span>
                      </td>
                      <td>{{ formatDate(transaction.transactionDate) }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Branch Management Tab -->
    <div *ngIf="activeTab === 'branches'" class="dashboard-content">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="fas fa-building me-2"></i>Branch Management
          </h5>
          <button class="btn btn-primary" (click)="openBranchModal()">
            <i class="fas fa-plus me-2"></i>Add Branch
          </button>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>City</th>
                  <th>Address</th>
                  <th>Cars</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let branch of branches">
                  <td>{{ branch.id }}</td>
                  <td>{{ branch.name }}</td>
                  <td>{{ branch.city }}</td>
                  <td>{{ branch.address }}</td>
                  <td>
                    <span class="badge bg-info">{{ branch.carCount }} cars</span>
                  </td>
                  <td>
                    <button class="btn btn-sm btn-outline-primary me-2" (click)="openBranchModal(branch)">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" (click)="deleteBranch(branch.id)">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User Modal -->
  <div class="modal fade" [class.show]="isUserModalOpen" [style.display]="isUserModalOpen ? 'block' : 'none'">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ selectedUser ? 'Edit User' : 'Add User' }}</h5>
          <button type="button" class="btn-close" (click)="closeUserModal()"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" [(ngModel)]="userForm.fullName" name="fullName">
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" [(ngModel)]="userForm.email" name="email">
            </div>
            <div class="mb-3">
              <label class="form-label">Role</label>
              <select class="form-select" [(ngModel)]="userForm.role" name="role">
                <option value="CUSTOMER">Customer</option>
                <option value="MANAGER">Manager</option>
                <option value="ADMIN">Admin</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeUserModal()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="saveUser()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Car Modal -->
  <div class="modal fade" [class.show]="isCarModalOpen" [style.display]="isCarModalOpen ? 'block' : 'none'">
    <div class="modal-dialog modal-fullscreen-lg-down modal-xl">
      <div class="modal-content modern-modal">
        <div class="modal-header modern-header">
          <div class="header-content">
            <div class="title-section">
              <i class="fas fa-car me-3"></i>
              <h4 class="modal-title mb-0">{{ selectedCar ? 'Edit Car' : 'Add New Vehicle' }}</h4>
            </div>
            <p class="header-subtitle mb-0">{{ selectedCar ? 'Update vehicle information and specifications' : 'Add comprehensive vehicle details for better customer experience' }}</p>
          </div>
          <button type="button" class="btn-close modern-close" (click)="closeCarModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <!-- Basic Information Section -->
            <div class="form-section modern-section mb-4">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-info-circle"></i>
                </div>
                <div class="section-info">
                  <h6 class="section-title">Basic Information</h6>
                  <p class="section-description">Essential vehicle details and identification</p>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Brand <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" [(ngModel)]="carForm.brand" name="brand" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Model <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" [(ngModel)]="carForm.model" name="model" required>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Year <span class="text-danger">*</span></label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.year" name="year" min="1900" max="2030" required>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Type <span class="text-danger">*</span></label>
                  <select class="form-select" [(ngModel)]="carForm.type" name="type" required>
                    <option value="">Select Type</option>
                    <option value="SEDAN">Sedan</option>
                    <option value="SUV">SUV</option>
                    <option value="HATCHBACK">Hatchback</option>
                    <option value="COUPE">Coupe</option>
                    <option value="CONVERTIBLE">Convertible</option>
                    <option value="WAGON">Wagon</option>
                    <option value="PICKUP">Pickup</option>
                    <option value="VAN">Van</option>
                    <option value="LUXURY">Luxury</option>
                    <option value="SPORTS">Sports</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Color</label>
                  <input type="text" class="form-control" [(ngModel)]="carForm.color" name="color" placeholder="e.g., Red, Blue, White">
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Price per Day <span class="text-danger">*</span></label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.price" name="price" min="0" step="0.01" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Branch <span class="text-danger">*</span></label>
                  <select class="form-select" [(ngModel)]="carForm.branchId" name="branchId" required>
                    <option value="">Select Branch</option>
                    <option *ngFor="let branch of branches" [value]="branch.id">
                      {{ branch.name }} - {{ branch.city }}
                    </option>
                  </select>
                </div>
              </div>
              <div class="mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" [(ngModel)]="carForm.availability" name="availability">
                  <label class="form-check-label">Available</label>
                </div>
              </div>
            </div>

            <!-- Technical Specifications Section -->
            <div class="form-section modern-section mb-4">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-cogs"></i>
                </div>
                <div class="section-info">
                  <h6 class="section-title">Technical Specifications</h6>
                  <p class="section-description">Engine, transmission, and mechanical details</p>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Fuel Type</label>
                  <select class="form-select" [(ngModel)]="carForm.fuelType" name="fuelType">
                    <option value="">Select Fuel Type</option>
                    <option value="GASOLINE">Gasoline</option>
                    <option value="DIESEL">Diesel</option>
                    <option value="HYBRID">Hybrid</option>
                    <option value="ELECTRIC">Electric</option>
                    <option value="PLUGIN_HYBRID">Plugin Hybrid</option>
                    <option value="HYDROGEN">Hydrogen</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Transmission</label>
                  <select class="form-select" [(ngModel)]="carForm.transmission" name="transmission">
                    <option value="">Select Transmission</option>
                    <option value="MANUAL">Manual</option>
                    <option value="AUTOMATIC">Automatic</option>
                    <option value="CVT">CVT</option>
                    <option value="SEMI_AUTOMATIC">Semi-Automatic</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Engine Size</label>
                  <input type="text" class="form-control" [(ngModel)]="carForm.engineSize" name="engineSize" placeholder="e.g., 2.0L, 3.5L">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Horsepower</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.horsepower" name="horsepower" min="0" placeholder="HP">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Torque (lb-ft)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.torque" name="torque" min="0" placeholder="lb-ft">
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Seating Capacity</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.seatingCapacity" name="seatingCapacity" min="2" max="15" placeholder="2-15">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Mileage (km)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.mileage" name="mileage" min="0" placeholder="Current mileage">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Fuel Tank Capacity (L)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.fuelTankCapacity" name="fuelTankCapacity" min="0" step="0.1" placeholder="Liters">
                </div>
              </div>
            </div>

            <!-- Performance & Efficiency Section -->
            <div class="form-section modern-section mb-4">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-tachometer-alt"></i>
                </div>
                <div class="section-info">
                  <h6 class="section-title">Performance & Efficiency</h6>
                  <p class="section-description">Speed, acceleration, and fuel economy metrics</p>
                </div>
              </div>
              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">0-60 mph (sec)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.acceleration0To60" name="acceleration0To60" min="0" step="0.1" placeholder="Seconds">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Top Speed (mph)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.topSpeed" name="topSpeed" min="0" placeholder="mph">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">City MPG</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.fuelEfficiencyCity" name="fuelEfficiencyCity" min="0" step="0.1" placeholder="mpg">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Highway MPG</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.fuelEfficiencyHighway" name="fuelEfficiencyHighway" min="0" step="0.1" placeholder="mpg">
                </div>
              </div>
            </div>

            <!-- Dimensions Section -->
            <div class="form-section modern-section mb-4">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-ruler-combined"></i>
                </div>
                <div class="section-info">
                  <h6 class="section-title">Dimensions</h6>
                  <p class="section-description">Physical measurements and capacity details</p>
                </div>
              </div>
              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Length (in)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.length" name="length" min="0" step="0.1" placeholder="inches">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Width (in)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.width" name="width" min="0" step="0.1" placeholder="inches">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Height (in)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.height" name="height" min="0" step="0.1" placeholder="inches">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Wheelbase (in)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.wheelbase" name="wheelbase" min="0" step="0.1" placeholder="inches">
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Curb Weight (lbs)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.curbWeight" name="curbWeight" min="0" placeholder="pounds">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Ground Clearance (in)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.groundClearance" name="groundClearance" min="0" step="0.1" placeholder="inches">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Trunk Capacity (cu ft)</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.trunkCapacity" name="trunkCapacity" min="0" step="0.1" placeholder="cubic feet">
                </div>
              </div>
            </div>

            <!-- Features Section -->
            <div class="form-section modern-section mb-4">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-star"></i>
                </div>
                <div class="section-info">
                  <h6 class="section-title">Features</h6>
                  <p class="section-description">Safety, entertainment, comfort, and technology features</p>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Safety Features</label>
                  <textarea class="form-control" [(ngModel)]="carForm.safetyFeatures" name="safetyFeatures" rows="3" placeholder="e.g., ABS, Airbags, Backup Camera, Blind Spot Detection"></textarea>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Entertainment Features</label>
                  <textarea class="form-control" [(ngModel)]="carForm.entertainmentFeatures" name="entertainmentFeatures" rows="3" placeholder="e.g., Bluetooth, USB, Apple CarPlay, Android Auto"></textarea>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Comfort Features</label>
                  <textarea class="form-control" [(ngModel)]="carForm.comfortFeatures" name="comfortFeatures" rows="3" placeholder="e.g., Leather Seats, Heated Seats, Climate Control, Sunroof"></textarea>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Technology Features</label>
                  <textarea class="form-control" [(ngModel)]="carForm.technologyFeatures" name="technologyFeatures" rows="3" placeholder="e.g., GPS Navigation, Keyless Entry, Push Start, Lane Assist"></textarea>
                </div>
              </div>
            </div>

            <!-- Rental Information Section -->
            <div class="form-section modern-section mb-4">
              <div class="section-header">
                <div class="section-icon">
                  <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="section-info">
                  <h6 class="section-title">Rental Information</h6>
                  <p class="section-description">Pricing, requirements, and rental policies</p>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">Weekly Rate</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.weeklyRate" name="weeklyRate" min="0" step="0.01" placeholder="Weekly price">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Monthly Rate</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.monthlyRate" name="monthlyRate" min="0" step="0.01" placeholder="Monthly price">
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">Deposit Amount</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.depositAmount" name="depositAmount" min="0" step="0.01" placeholder="Security deposit">
                </div>
              </div>
              <div class="row">
                <div class="col-md-3 mb-3">
                  <label class="form-label">Min Rental Days</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.minimumRentalDays" name="minimumRentalDays" min="1" placeholder="Minimum days">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Max Rental Days</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.maximumRentalDays" name="maximumRentalDays" min="1" placeholder="Maximum days">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Age Requirement</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.ageRequirement" name="ageRequirement" min="18" max="100" placeholder="Minimum age">
                </div>
                <div class="col-md-3 mb-3">
                  <label class="form-label">Additional Driver Fee</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.additionalDriverFee" name="additionalDriverFee" min="0" step="0.01" placeholder="Per day fee">
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">License Requirement</label>
                  <input type="text" class="form-control" [(ngModel)]="carForm.licenseRequirement" name="licenseRequirement" placeholder="e.g., Valid driver's license, International permit">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">Late Return Fee</label>
                  <input type="number" class="form-control" [(ngModel)]="carForm.lateReturnFee" name="lateReturnFee" min="0" step="0.01" placeholder="Per hour fee">
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" [(ngModel)]="carForm.insuranceIncluded" name="insuranceIncluded">
                    <label class="form-check-label">Insurance Included</label>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" [(ngModel)]="carForm.maintenanceIncluded" name="maintenanceIncluded">
                    <label class="form-check-label">Maintenance Included</label>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" [(ngModel)]="carForm.unlimitedMileage" name="unlimitedMileage">
                    <label class="form-check-label">Unlimited Mileage</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" [(ngModel)]="carForm.isFeatured" name="isFeatured">
                    <label class="form-check-label">Featured Car</label>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" [(ngModel)]="carForm.isNewArrival" name="isNewArrival">
                    <label class="form-check-label">New Arrival</label>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" [(ngModel)]="carForm.isPopular" name="isPopular">
                    <label class="form-check-label">Popular Car</label>
                  </div>
                </div>
              </div>
            </div>
             
             <!-- Image Upload Section -->
             <div class="mb-3">
               <label class="form-label">Car Images</label>
               <div class="image-upload-section">
                 <div class="upload-area" (click)="fileInput.click()" 
                      [class.dragover]="isDragOver"
                      (dragover)="onDragOver($event)"
                      (dragleave)="onDragLeave($event)"
                      (drop)="onDrop($event)">
                   <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
                   <p class="mb-1">Click to upload or drag & drop images here</p>
                   <small class="text-muted">Supports: JPG, PNG, WebP (Max: 5MB each)</small>
                   <input #fileInput type="file" multiple accept="image/*" 
                          (change)="onFileSelected($event)" style="display: none;">
                 </div>
                 
                 <!-- Upload Progress -->
                 <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="mt-2">
                   <div class="progress">
                     <div class="progress-bar" [style.width.%]="uploadProgress"></div>
                   </div>
                   <small class="text-muted">Uploading... {{ uploadProgress }}%</small>
                 </div>
                 
                 <!-- Selected Files Preview -->
                 <div *ngIf="selectedFiles.length > 0" class="mt-3">
                   <h6>Selected Files ({{ selectedFiles.length }})</h6>
                   <div class="selected-files">
                     <div *ngFor="let file of selectedFiles; let i = index" class="file-item">
                       <img [src]="getFilePreview(file)" alt="Preview" class="file-preview">
                       <div class="file-info">
                         <small>{{ file.name }}</small>
                         <small class="text-muted">{{ formatFileSize(file.size) }}</small>
                       </div>
                       <button type="button" class="btn btn-sm btn-outline-danger" 
                               (click)="removeFile(i)">
                         <i class="fas fa-times"></i>
                       </button>
                     </div>
                   </div>
                 </div>
                 
                 <!-- Existing Images -->
                 <div *ngIf="carImages.length > 0" class="mt-3">
                   <h6>Existing Images ({{ carImages.length }})</h6>
                   <div class="existing-images">
                     <div *ngFor="let image of carImages" class="image-item">
                       <img [src]="getImageUrl(image.filePath)" [alt]="image.altText || 'Car image'" 
                            class="image-preview">
                       <div class="image-overlay">
                         <div class="image-actions">
                           <button type="button" class="btn btn-sm btn-outline-primary" 
                                   (click)="setPrimaryImage(image.id)" 
                                   [disabled]="image.isPrimary">
                             <i class="fas fa-star"></i>
                           </button>
                           <button type="button" class="btn btn-sm btn-outline-danger" 
                                   (click)="deleteImage(image.id)">
                             <i class="fas fa-trash"></i>
                           </button>
                         </div>
                         <div class="image-badge" *ngIf="image.isPrimary">
                           <span class="badge bg-warning">Primary</span>
                         </div>
                       </div>
                     </div>
                   </div>
                 </div>
                 
                 <!-- Existing Images -->
                 <div *ngIf="carImages.length > 0" class="mt-3">
                   <h6>Existing Images ({{ carImages.length }})</h6>
                   <div class="existing-images">
                     <div *ngFor="let image of carImages" class="image-item">
                       <img [src]="getImageUrl(image.filePath)" [alt]="image.altText || 'Car image'" 
                            class="image-preview">
                       <div class="image-overlay">
                         <div class="image-actions">
                           <button type="button" class="btn btn-sm btn-outline-primary" 
                                   (click)="setPrimaryImage(image.id)" 
                                   [disabled]="image.isPrimary">
                             <i class="fas fa-star"></i>
                           </button>
                           <button type="button" class="btn btn-sm btn-outline-danger" 
                                   (click)="deleteImage(image.id)">
                             <i class="fas fa-trash"></i>
                           </button>
                         </div>
                         <div class="image-badge" *ngIf="image.isPrimary">
                           <span class="badge bg-warning">Primary</span>
                         </div>
                       </div>
                     </div>
                   </div>
                 </div>
               </div>
             </div>
          </form>
        </div>
        <div class="modal-footer modern-footer">
          <div class="footer-content">
            <div class="form-progress">
              <div class="progress-info">
                <span class="progress-text">Form Progress</span>
                <span class="progress-percentage">100%</span>
              </div>
              <div class="progress-bar-container">
                <div class="progress-bar-fill"></div>
              </div>
            </div>
            <div class="action-buttons">
              <button type="button" class="btn btn-outline-secondary modern-btn" (click)="closeCarModal()">
                <i class="fas fa-times me-2"></i>Cancel
              </button>
              <button type="button" class="btn btn-primary modern-btn-primary" (click)="saveCar()">
                <i class="fas fa-save me-2"></i>{{ selectedCar ? 'Update Vehicle' : 'Add Vehicle' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Booking Modal -->
  <div class="modal fade" [class.show]="isBookingModalOpen" [style.display]="isBookingModalOpen ? 'block' : 'none'">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Booking Details</h5>
          <button type="button" class="btn-close" (click)="closeBookingModal()"></button>
        </div>
        <div class="modal-body" *ngIf="selectedBooking">
          <div class="booking-details">
            <p><strong>User:</strong> {{ selectedBooking.userFullName }}</p>
            <p><strong>Car:</strong> {{ selectedBooking.carBrand }} {{ selectedBooking.carModel }}</p>
            <p><strong>Start Date:</strong> {{ formatDate(selectedBooking.startDate) }}</p>
            <p><strong>End Date:</strong> {{ formatDate(selectedBooking.endDate) }}</p>
            <p><strong>Status:</strong> 
              <span class="badge" [class]="getStatusColor(selectedBooking.status)">
                {{ selectedBooking.status }}
              </span>
            </p>
          </div>
          <div class="mt-3">
            <label class="form-label">Update Status</label>
            <select class="form-select" #statusSelect>
              <option value="ACTIVE">Active</option>
              <option value="COMPLETED">Completed</option>
              <option value="CANCELLED">Cancelled</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeBookingModal()">Close</button>
          <button type="button" class="btn btn-primary" (click)="updateBookingStatus(selectedBooking!.id, statusSelect.value)">
            Update Status
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Branch Modal -->
  <div class="modal fade" [class.show]="isBranchModalOpen" [style.display]="isBranchModalOpen ? 'block' : 'none'">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ selectedBranch ? 'Edit Branch' : 'Add Branch' }}</h5>
          <button type="button" class="btn-close" (click)="closeBranchModal()"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label class="form-label">Name <span class="text-danger">*</span></label>
              <input type="text" class="form-control" [(ngModel)]="branchForm.name" name="name" required>
            </div>
            <div class="mb-3">
              <label class="form-label">City <span class="text-danger">*</span></label>
              <input type="text" class="form-control" [(ngModel)]="branchForm.city" name="city" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Address <span class="text-danger">*</span></label>
              <textarea class="form-control" [(ngModel)]="branchForm.address" name="address" rows="3" required></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeBranchModal()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="saveBranch()">Save</button>
        </div>
      </div>
    </div>
  </div>
</div> 
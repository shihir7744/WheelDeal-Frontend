import{K as a,N as i,S as o,Sb as n,j as u}from"./chunk-N4QFKIMT.js";var l={production:!0,apiUrl:"https://wheeldeal-backend-production.up.railway.app/api",baseUrl:"https://wheeldeal-backend-production.up.railway.app"};var p=class s{constructor(e){this.http=e;this.clearInvalidToken();let t=this.getToken();if(t&&!this.isTokenExpired(t)){let r=this.getUserFromToken(t);r?this.currentUserSubject.next(r):this.logout()}}apiUrl=l.apiUrl+"/auth";currentUserSubject=new u(null);currentUser$=this.currentUserSubject.asObservable();login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(a(t=>{this.setToken(t.token);let r={id:t.id,email:t.email,fullName:t.fullName,role:t.role};this.currentUserSubject.next(r)}))}register(e){return this.http.post(`${this.apiUrl}/register`,e).pipe(a(t=>{this.setToken(t.token);let r={id:t.id,email:t.email,fullName:t.fullName,role:t.role};this.currentUserSubject.next(r)}))}logout(){localStorage.removeItem("token"),this.currentUserSubject.next(null),console.log("AuthService - User logged out, token cleared")}clearInvalidToken(){let e=this.getToken();e&&this.isTokenExpired(e)&&(console.log("AuthService - Clearing expired token"),localStorage.removeItem("token"),this.currentUserSubject.next(null))}getToken(){return localStorage.getItem("token")}setToken(e){localStorage.setItem("token",e)}isLoggedIn(){let e=this.getToken();return e?!this.isTokenExpired(e):!1}getCurrentUser(){return this.currentUserSubject.value}hasRole(e){let t=this.getCurrentUser();return t?t.role===e:!1}refreshUserState(){let e=this.getToken();if(e&&!this.isTokenExpired(e)){let t=this.getUserFromToken(e);t?this.currentUserSubject.next(t):this.logout()}else e&&this.isTokenExpired(e)&&this.logout()}getUserFromToken(e){try{let t=JSON.parse(atob(e.split(".")[1])),r={id:t.id,email:t.sub,fullName:t.fullName,role:t.role};return!r.id||!r.email||!r.fullName||!r.role?(console.error("Invalid JWT payload - missing required fields"),null):r}catch(t){return console.error("Error decoding JWT token:",t),null}}isTokenExpired(e){try{let r=JSON.parse(atob(e.split(".")[1])).exp*1e3;return Date.now()>=r}catch{return!0}}static \u0275fac=function(t){return new(t||s)(o(n))};static \u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"})};var c=class s{constructor(e){this.http=e}apiUrl=l.apiUrl+"/users";getAllUsers(){return this.http.get(this.apiUrl)}getUserById(e){return this.http.get(`${this.apiUrl}/${e}`)}createUser(e){return this.http.post(this.apiUrl,e)}updateUser(e,t){return this.http.put(`${this.apiUrl}/${e}`,t)}deleteUser(e){return this.http.delete(`${this.apiUrl}/${e}`)}getUsersByRole(e){return this.http.get(`${this.apiUrl}/role/${e}`)}searchUsers(e){return this.http.get(`${this.apiUrl}/search?q=${e}`)}updateUserRole(e,t){return this.http.patch(`${this.apiUrl}/${e}/role`,{role:t})}updateUserStatus(e,t){return this.http.patch(`${this.apiUrl}/${e}/status`,{status:t})}static \u0275fac=function(t){return new(t||s)(o(n))};static \u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"})};export{l as a,p as b,c};
